(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var o=t.n(e);const a=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/utils/DiscussionControls"];var r=t.n(n);const s=flarum.core.compat["common/components/Button"];var i=t.n(s);const c=flarum.core.compat["tags/forum/components/TagDiscussionModal"];var l=t.n(c);const u=flarum.core.compat["tags/forum/components/TagSelectionModal"];var d=t.n(u);function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}const f=flarum.core.compat["common/utils/classList"];var g=t.n(f);const h=flarum.core.compat["common/helpers/highlight"];var v=t.n(h);const y=flarum.core.compat["common/components/LoadingIndicator"];var b=t.n(y);const T=flarum.core.compat["common/utils/extractText"];var N=t.n(T);const S=flarum.core.compat["tags/common/helpers/tagIcon"];var I=t.n(S);const _=flarum.core.compat["tags/common/helpers/tagLabel"];var L=t.n(_);const M=flarum.core.compat["tags/forum/components/ToggleButton"];var w=t.n(M);function C(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return F(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?F(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=Array(e);o<e;o++)a[o]=t[o];return a}function x(t){for(var e,o=0,a=C(t||"");!(e=a()).done;){var n=e.value;o+=/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/.test(n)?2:1}return o}var k=function(t){function e(){return t.apply(this,arguments)||this}var a,n;n=t,(a=e).prototype=Object.create(n.prototype),a.prototype.constructor=a,p(a,n);var r=e.prototype;return r.view=function(e){return t.prototype.view.call(this,e)},r.content=function(){var t,e=this;if(this.loading||!this.tags)return m(b(),null);var a=this.primaryCount(),n=this.secondaryCount(),r=this.getFilteredTags(),s=N()(this.getInstruction(a,n)),c=Math.max(x(s),x(this.filter())),l=o().forum.attribute("tagCategories")||[],u=new Map(r.map(function(t){return[Number(t.id()),t]})),d=l.map(function(t){return{group:t,tags:(t.tagIds||[]).map(function(t){return u.get(Number(t))}).filter(Boolean)}}).filter(function(t){return t.tags.length}),p=new Set;d.forEach(function(t){return t.tags.forEach(function(t){return p.add(Number(t.id()))})});var f=r.filter(function(t){return!p.has(Number(t.id()))}),g=[];if(d.length){for(var h,v=C(d);!(h=v()).done;){var y=h.value,T=y.group,S=y.tags;g.push(m("li",{className:"TagSelectionModal-groupHeader"},T.name)),g.push.apply(g,S.map(function(t){return e.renderTagLi(t)}))}f.length&&(g.push(m("li",{className:"TagSelectionModal-groupHeader"},o().translator.trans("lady-byron-tag-categories.forum.tag_selection.ungrouped"))),g.push.apply(g,f.map(function(t){return e.renderTagLi(t)})))}else g.push.apply(g,r.map(function(t){return e.renderTagLi(t)}));return[m("div",{className:"Modal-body"},m("div",{className:"TagSelectionModal-form"},m("div",{className:"TagSelectionModal-form-input"},m("div",{className:"TagsInput FormControl "+(this.focused?"focus":""),onclick:function(){return e.$(".TagsInput input").focus()}},m("span",{className:"TagsInput-selected"},this.selected.map(function(t){return m("span",{className:"TagsInput-tag",onclick:function(){e.removeTag(t),e.onready()}},L()(t))})),m("input",{className:"FormControl",placeholder:s,bidi:this.filter,style:{width:c+"ch"},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){return e.focused=!0},onblur:function(){return e.focused=!1}}))),m("div",{className:"TagSelectionModal-form-submit App-primaryControl"},m(i(),{type:"submit",className:"Button Button--primary",disabled:!this.meetsRequirements(a,n),icon:"fas fa-check"},o().translator.trans("flarum-tags.lib.tag_selection_modal.submit_button"))))),m("div",{className:"Modal-footer"},m("ul",{className:"TagSelectionModal-list SelectTagList"},g),(null==(t=this.attrs.limits)?void 0:t.allowBypassing)&&m("div",{className:"TagSelectionModal-controls"},m(w(),{className:"Button",onclick:function(){return e.bypassReqs=!e.bypassReqs},isToggled:this.bypassReqs},o().translator.trans("flarum-tags.lib.tag_selection_modal.bypass_requirements"))))]},r.renderTagLi=function(t){var e=this,o=this.selected.includes(t),a=this.indexTag===t,n=this.filter().toLowerCase();return m("li",{"data-index":t.id(),className:g()("SelectTagListItem",{pinned:null!==t.position(),child:!!t.parent(),colored:!!t.color(),selected:o,active:a}),style:{color:t.color()||void 0},onmouseover:function(){return e.indexTag=t},onclick:this.toggleTag.bind(this,t)},m("i",{className:"SelectTagListItem-icon"},I()(t,{className:"SelectTagListItem-tagIcon"}),o?m("i",{className:"icon TagIcon fas fa-check SelectTagListItem-checkIcon"}):null),m("span",{className:"SelectTagListItem-name"},v()(t.name(),n)),t.description()?m("span",{className:"SelectTagListItem-description"},t.description()):"")},e}(l());o().initializers.add("lady-byron/tag-categories",function(){var t=o().modal.show.bind(o().modal);o().modal.show=function(e,a){return!(o().forum.attribute("tagCategories")||[]).length||e!==l()&&e!==d()||(e=k),t(e,a)},(0,a.extend)(r(),"moderationControls",function(t,e){e.canTag&&e.canTag()&&t.add("tags",m(i(),{icon:"fas fa-tag",onclick:function(){return o().modal.show(k,{discussion:e})}},o().translator.trans("flarum-tags.forum.discussion_controls.edit_tags_button")),100)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map