(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var o=t.n(e);const a=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/utils/DiscussionControls"];var r=t.n(n);const i=flarum.core.compat["common/components/Button"];var s=t.n(i);const c=flarum.core.compat["tags/forum/components/TagDiscussionModal"];var l=t.n(c);const u=flarum.core.compat["tags/forum/components/TagSelectionModal"];var d=t.n(u);function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}const f=flarum.core.compat["common/utils/classList"];var g=t.n(f);const h=flarum.core.compat["common/helpers/highlight"];var v=t.n(h);const y=flarum.core.compat["common/components/LoadingIndicator"];var b=t.n(y);const T=flarum.core.compat["common/utils/extractText"];var N=t.n(T);const S=flarum.core.compat["tags/common/helpers/tagIcon"];var k=t.n(S);const _=flarum.core.compat["tags/common/helpers/tagLabel"];var I=t.n(_);const w=flarum.core.compat["tags/forum/components/ToggleButton"];var M=t.n(w);function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=Array(e);o<e;o++)a[o]=t[o];return a}function x(t){for(var e,o=0,a=function(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return L(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?L(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t||"");!(e=a()).done;){var n=e.value;o+=/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/.test(n)?2:1}return o}var C=function(t){function e(){for(var e,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).collapsedGroups=void 0,e.initialized=!1,e}var a,n;n=t,(a=e).prototype=Object.create(n.prototype),a.prototype.constructor=a,p(a,n);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.collapsedGroups=new Set,this.initialized=!1},r.oncreate=function(e){var a;t.prototype.oncreate.call(this,e);var n=null==(a=this.element)?void 0:a.querySelector(".Modal-close");n&&(n.getAttribute("type")||n.setAttribute("type","button"),n.onclick=function(){return o().modal.close()})},r.view=function(e){return t.prototype.view.call(this,e)},r.content=function(){var t,e=this;if(this.loading||!this.tags)return m(b(),null);var a=this.primaryCount(),n=this.secondaryCount(),r=this.getFilteredTags(),i=N()(this.getInstruction(a,n)),c=Math.max(x(i),x(this.filter())),l=o().forum.attribute("tagCategories")||[],u=new Map(r.map(function(t){return[Number(t.id()),t]})),d=l.map(function(t){return{group:t,tags:(t.tagIds||[]).map(function(t){return u.get(Number(t))}).filter(Boolean)}}).filter(function(t){return t.tags.length}),p=new Set;d.forEach(function(t){return t.tags.forEach(function(t){return p.add(Number(t.id()))})});var f=r.filter(function(t){return!p.has(Number(t.id()))}),h=[];this.initialized||(d.forEach(function(t,o){var a=t.group;o>0&&e.collapsedGroups.add(A(a))}),f.length&&this.collapsedGroups.add("__ungrouped__"),this.initialized=!0);var v=function(t){e.collapsedGroups.has(t)?e.collapsedGroups.delete(t):e.collapsedGroups.add(t)};if(d.length){if(d.forEach(function(t,o){var a=t.group,n=t.tags,r=A(a);if(0===o)h.push(m("li",{key:"gh-"+r,className:"TagSelectionModal-groupHeader non-collapsible"},a.name)),h.push.apply(h,n.map(function(t){return e.renderTagLi(t,"li-"+r+"-"+t.id())}));else{var i=e.collapsedGroups.has(r);h.push(m("li",{key:"gh-"+r,className:g()("TagSelectionModal-groupHeader",{collapsed:i}),role:"button","aria-expanded":!i,tabindex:"0",onclick:function(){return v(r)},onkeydown:function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),v(r))}},m("i",{className:"fas fa-chevron-down TagSelectionModal-groupHeader-caret"}),a.name)),i||h.push.apply(h,n.map(function(t){return e.renderTagLi(t,"li-"+r+"-"+t.id())}))}}),f.length){var y="__ungrouped__",T=this.collapsedGroups.has(y);h.push(m("li",{key:"gh-"+y,className:g()("TagSelectionModal-groupHeader",{collapsed:T}),role:"button","aria-expanded":!T,tabindex:"0",onclick:function(){return v(y)},onkeydown:function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),v(y))}},m("i",{className:"fas fa-chevron-down TagSelectionModal-groupHeader-caret"}),o().translator.trans("lady-byron-tag-categories.forum.tag_selection.ungrouped"))),T||h.push.apply(h,f.map(function(t){return e.renderTagLi(t,"li-"+y+"-"+t.id())}))}}else h.push.apply(h,r.map(function(t){return e.renderTagLi(t,"li-"+t.id())}));return[m("div",{className:"Modal-body"},m("div",{className:"TagSelectionModal-form"},m("div",{className:"TagSelectionModal-form-input"},m("div",{className:"TagsInput FormControl "+(this.focused?"focus":""),onclick:function(){return e.$(".TagsInput input").focus()}},m("span",{className:"TagsInput-selected"},this.selected.map(function(t){return m("span",{key:"sel-"+t.id(),className:"TagsInput-tag",onclick:function(){e.removeTag(t),e.onready()}},I()(t))})),m("input",{className:"FormControl",placeholder:i,bidi:this.filter,style:{width:c+"ch"},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){return e.focused=!0},onblur:function(){return e.focused=!1}}))),m("div",{className:"TagSelectionModal-form-submit App-primaryControl"},m(s(),{type:"submit",className:"Button Button--primary",disabled:!this.meetsRequirements(a,n),icon:"fas fa-check"},o().translator.trans("flarum-tags.lib.tag_selection_modal.submit_button"))))),m("div",{className:"Modal-footer"},m("ul",{className:"TagSelectionModal-list SelectTagList"},h),(null==(t=this.attrs.limits)?void 0:t.allowBypassing)&&m("div",{className:"TagSelectionModal-controls"},m(M(),{className:"Button",onclick:function(){return e.bypassReqs=!e.bypassReqs},isToggled:this.bypassReqs},o().translator.trans("flarum-tags.lib.tag_selection_modal.bypass_requirements"))))]},r.renderTagLi=function(t,e){var o=this,a=this.selected.includes(t),n=this.indexTag===t,r=this.filter().toLowerCase();return m("li",{key:null!=e?e:"li-"+t.id(),"data-index":t.id(),className:g()("SelectTagListItem",{pinned:null!==t.position(),child:!!t.parent(),colored:!!t.color(),selected:a,active:n}),style:{color:t.color()||void 0},onmouseover:function(){return o.indexTag=t},onclick:this.toggleTag.bind(this,t)},m("i",{className:"SelectTagListItem-icon"},t.icon()?k()(t,{className:"SelectTagListItem-tagIcon"}):a?m("i",{className:"icon TagIcon fas fa-check SelectTagListItem-checkIcon",style:{color:"black"}}):k()(t,{className:"SelectTagListItem-tagIcon"})),m("span",{className:"SelectTagListItem-name"},v()(t.name(),r)),t.description()?m("span",{className:"SelectTagListItem-description"},t.description()):"")},e}(l());function A(t){var e,o;return String(null!=(e=null!=(o=t.id)?o:t.slug)?e:t.name)}C.isDismissibleViaEscKey=!0,C.isDismissibleViaBackdropClick=!0,C.isDismissibleViaCloseButton=!0,o().initializers.add("lady-byron/tag-categories",function(){var t=o().modal.show.bind(o().modal);o().modal.show=function(e,a){return!(o().forum.attribute("tagCategories")||[]).length||e!==l()&&e!==d()||(e=C),t(e,a)},(0,a.extend)(r(),"moderationControls",function(t,e){e.canTag&&e.canTag()&&t.add("tags",m(s(),{icon:"fas fa-tag",onclick:function(){return o().modal.show(C,{discussion:e})}},o().translator.trans("flarum-tags.forum.discussion_controls.edit_tags_button")),100)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map