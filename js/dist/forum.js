(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var o=t.n(e);const a=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/utils/DiscussionControls"];var r=t.n(n);const s=flarum.core.compat["common/components/Button"];var i=t.n(s);const c=flarum.core.compat["tags/forum/components/TagDiscussionModal"];var l=t.n(c);const u=flarum.core.compat["tags/forum/components/TagSelectionModal"];var d=t.n(u);function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}const f=flarum.core.compat["common/utils/classList"];var g=t.n(f);const h=flarum.core.compat["common/helpers/highlight"];var v=t.n(h);const y=flarum.core.compat["common/components/LoadingIndicator"];var b=t.n(y);const T=flarum.core.compat["common/utils/extractText"];var N=t.n(T);const S=flarum.core.compat["tags/common/helpers/tagIcon"];var _=t.n(S);const I=flarum.core.compat["tags/common/helpers/tagLabel"];var w=t.n(I);const M=flarum.core.compat["tags/forum/components/ToggleButton"];var L=t.n(M);function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,a=Array(e);o<e;o++)a[o]=t[o];return a}function C(t){for(var e,o=0,a=function(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return k(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?k(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t||"");!(e=a()).done;){var n=e.value;o+=/[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/.test(n)?2:1}return o}var F=function(t){function e(){for(var e,o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).collapsedGroups=void 0,e.initialized=!1,e}var a,n;n=t,(a=e).prototype=Object.create(n.prototype),a.prototype.constructor=a,p(a,n);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.collapsedGroups=new Set,this.initialized=!1},r.view=function(e){return t.prototype.view.call(this,e)},r.content=function(){var t,e=this;if(this.loading||!this.tags)return m(b(),null);var a=this.primaryCount(),n=this.secondaryCount(),r=this.getFilteredTags(),s=N()(this.getInstruction(a,n)),c=Math.max(C(s),C(this.filter())),l=o().forum.attribute("tagCategories")||[],u=new Map(r.map(function(t){return[Number(t.id()),t]})),d=l.map(function(t){return{group:t,tags:(t.tagIds||[]).map(function(t){return u.get(Number(t))}).filter(Boolean)}}).filter(function(t){return t.tags.length}),p=new Set;d.forEach(function(t){return t.tags.forEach(function(t){return p.add(Number(t.id()))})});var f=r.filter(function(t){return!p.has(Number(t.id()))}),h=[];this.initialized||(d.forEach(function(t,o){var a=t.group;o>0&&e.collapsedGroups.add(a.name)}),f.length&&this.collapsedGroups.add("__ungrouped__"),this.initialized=!0);var v=function(t){e.collapsedGroups.has(t)?e.collapsedGroups.delete(t):e.collapsedGroups.add(t)};if(d.length){if(d.forEach(function(t,o){var a=t.group,n=t.tags;if(0===o)h.push(m("li",{className:"TagSelectionModal-groupHeader non-collapsible"},a.name)),h.push.apply(h,n.map(function(t){return e.renderTagLi(t)}));else{var r=e.collapsedGroups.has(a.name);h.push(m("li",{className:g()("TagSelectionModal-groupHeader",{collapsed:r}),onclick:function(){return v(a.name)}},m("i",{className:"fas fa-chevron-down TagSelectionModal-groupHeader-caret"}),a.name)),r||h.push.apply(h,n.map(function(t){return e.renderTagLi(t)}))}}),f.length){var y="__ungrouped__",T=this.collapsedGroups.has(y);h.push(m("li",{className:g()("TagSelectionModal-groupHeader",{collapsed:T}),onclick:function(){return v(y)}},m("i",{className:"fas fa-chevron-down TagSelectionModal-groupHeader-caret"}),o().translator.trans("lady-byron-tag-categories.forum.tag_selection.ungrouped"))),T||h.push.apply(h,f.map(function(t){return e.renderTagLi(t)}))}}else h.push.apply(h,r.map(function(t){return e.renderTagLi(t)}));return[m("div",{className:"Modal-body"},m("div",{className:"TagSelectionModal-form"},m("div",{className:"TagSelectionModal-form-input"},m("div",{className:"TagsInput FormControl "+(this.focused?"focus":""),onclick:function(){return e.$(".TagsInput input").focus()}},m("span",{className:"TagsInput-selected"},this.selected.map(function(t){return m("span",{className:"TagsInput-tag",onclick:function(){e.removeTag(t),e.onready()}},w()(t))})),m("input",{className:"FormControl",placeholder:s,bidi:this.filter,style:{width:c+"ch"},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){return e.focused=!0},onblur:function(){return e.focused=!1}}))),m("div",{className:"TagSelectionModal-form-submit App-primaryControl"},m(i(),{type:"submit",className:"Button Button--primary",disabled:!this.meetsRequirements(a,n),icon:"fas fa-check"},o().translator.trans("flarum-tags.lib.tag_selection_modal.submit_button"))))),m("div",{className:"Modal-footer"},m("ul",{className:"TagSelectionModal-list SelectTagList"},h),(null==(t=this.attrs.limits)?void 0:t.allowBypassing)&&m("div",{className:"TagSelectionModal-controls"},m(L(),{className:"Button",onclick:function(){return e.bypassReqs=!e.bypassReqs},isToggled:this.bypassReqs},o().translator.trans("flarum-tags.lib.tag_selection_modal.bypass_requirements"))))]},r.renderTagLi=function(t){var e=this,o=this.selected.includes(t),a=this.indexTag===t,n=this.filter().toLowerCase();return m("li",{"data-index":t.id(),className:g()("SelectTagListItem",{pinned:null!==t.position(),child:!!t.parent(),colored:!!t.color(),selected:o,active:a}),style:{color:t.color()||void 0},onmouseover:function(){return e.indexTag=t},onclick:this.toggleTag.bind(this,t)},m("i",{className:"SelectTagListItem-icon"},t.icon()?_()(t,{className:"SelectTagListItem-tagIcon"}):o?m("i",{className:"icon TagIcon fas fa-check SelectTagListItem-checkIcon",style:{color:"black"}}):_()(t,{className:"SelectTagListItem-tagIcon"})),m("span",{className:"SelectTagListItem-name"},v()(t.name(),n)),t.description()?m("span",{className:"SelectTagListItem-description"},t.description()):"")},e}(l());o().initializers.add("lady-byron/tag-categories",function(){var t=o().modal.show.bind(o().modal);o().modal.show=function(e,a){return!(o().forum.attribute("tagCategories")||[]).length||e!==l()&&e!==d()||(e=F),t(e,a)},(0,a.extend)(r(),"moderationControls",function(t,e){e.canTag&&e.canTag()&&t.add("tags",m(i(),{icon:"fas fa-tag",onclick:function(){return o().modal.show(F,{discussion:e})}},o().translator.trans("flarum-tags.forum.discussion_controls.edit_tags_button")),100)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map