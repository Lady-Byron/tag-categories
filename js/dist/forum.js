(()=>{var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var n=t.n(e);const o=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/utils/DiscussionControls"];var r=t.n(a);const s=flarum.core.compat["common/components/Button"];var i=t.n(s);const c=flarum.core.compat["tags/forum/components/TagDiscussionModal"];var l=t.n(c);const u=flarum.core.compat["tags/forum/components/TagSelectionModal"];var d=t.n(u);function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}const g=flarum.core.compat["common/utils/classList"];var p=t.n(g);const h=flarum.core.compat["common/helpers/highlight"];var v=t.n(h);const y=flarum.core.compat["common/components/LoadingIndicator"];var b=t.n(y);const T=flarum.core.compat["tags/common/helpers/tagIcon"];var N=t.n(T);function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var S=function(t){function e(){return t.apply(this,arguments)||this}var o,a;a=t,(o=e).prototype=Object.create(a.prototype),o.prototype.constructor=o,f(o,a);var r=e.prototype;return r.view=function(e){return t.prototype.view.call(this,e)},r.content=function(){var t,e=this;if(this.loading||!this.tags)return m(b(),null);var o=this.filter().toLowerCase(),a=this.primaryCount(),r=this.secondaryCount(),s=this.getFilteredTags(),c=Math.max(this.lengthWithCJK(_(this.getInstruction(a,r))),this.lengthWithCJK(this.filter())),l=n().forum.attribute("tagCategories")||[],u=new Map(s.map(function(t){return[Number(t.id()),t]})),d=l.map(function(t){return{group:t,tags:(t.tagIds||[]).map(function(t){return u.get(Number(t))}).filter(Boolean)}}).filter(function(t){return t.tags.length>0}),f=new Set;d.forEach(function(t){return t.tags.forEach(function(t){return f.add(Number(t.id()))})});var g=s.filter(function(t){return!f.has(Number(t.id()))}),h=[];if(d.length){for(var v,y=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return I(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0;return function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(d);!(v=y()).done;){var T,N=v.value,S=N.group,M=N.tags;(T=h).push.apply(T,[m("li",{className:"TagSelectionModal-groupHeader"},S.name)].concat(M.map(function(t){return e.renderTagLi(t,o)})))}var w;g.length&&(w=h).push.apply(w,[m("li",{className:"TagSelectionModal-groupHeader"},n().translator.trans("lady-byron-tag-categories.forum.tag_selection.ungrouped"))].concat(g.map(function(t){return e.renderTagLi(t,o)})))}else h=s.map(function(t){return e.renderTagLi(t,o)});return[m("div",{className:"Modal-body"},m("div",{className:"TagSelectionModal-form"},m("div",{className:"TagSelectionModal-form-input"},m("div",{className:"TagsInput FormControl "+(this.focused?"focus":""),onclick:function(){return e.$(".TagsInput input").focus()}},m("span",{className:"TagsInput-selected"},this.selected.map(function(t){return m("span",{className:"TagsInput-tag",onclick:function(){e.removeTag(t),e.onready()}},function(t){return t.name()}(t))})),m("input",{className:"FormControl",placeholder:_(this.getInstruction(a,r)),bidi:this.filter,style:{width:c+"ch"},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:function(){return e.focused=!0},onblur:function(){return e.focused=!1}}))),m("div",{className:"TagSelectionModal-form-submit App-primaryControl"},m(i(),{type:"submit",className:"Button Button--primary",disabled:!this.meetsRequirements(a,r),icon:"fas fa-check"},n().translator.trans("flarum-tags.lib.tag_selection_modal.submit_button"))))),m("div",{className:"Modal-footer"},m("ul",{className:"TagSelectionModal-list SelectTagList"},h),(null==(t=this.attrs.limits)?void 0:t.allowBypassing)&&m("div",{className:"TagSelectionModal-controls"},m("button",{className:p()("Button",{"Button--toggled":this.bypassReqs}),onclick:function(){return e.bypassReqs=!e.bypassReqs}},n().translator.trans("flarum-tags.lib.tag_selection_modal.bypass_requirements"))))]},r.renderTagLi=function(t,e){var n=this,o=this.selected.includes(t),a=this.indexTag===t;return m("li",{"data-index":t.id(),className:p()("SelectTagListItem",{pinned:null!==t.position(),child:!!t.parent(),colored:!!t.color(),selected:o,active:a}),style:{color:t.color()||void 0},onmouseover:function(){return n.indexTag=t},onclick:this.toggleTag.bind(this,t)},m("i",{className:"SelectTagListItem-icon"},N()(t,{className:"SelectTagListItem-tagIcon"}),m("i",{className:"icon TagIcon fas fa-check SelectTagListItem-checkIcon"})),m("span",{className:"SelectTagListItem-name"},v()(t.name(),e)),t.description()?m("span",{className:"SelectTagListItem-description"},t.description()):"")},e}(l());function _(t){return"string"==typeof t?t:""}n().initializers.add("lady-byron/tag-categories",function(){var t=n().modal.show.bind(n().modal);n().modal.show=function(e,o){return!(n().forum.attribute("tagCategories")||[]).length||e!==l()&&e!==d()||(e=S),t(e,o)},(0,o.extend)(r(),"moderationControls",function(t,e){e.canTag&&e.canTag()&&t.add("tags",m(i(),{icon:"fas fa-tag",onclick:function(){return n().modal.show(S,{discussion:e})}},n().translator.trans("flarum-tags.forum.discussion_controls.edit_tags_button")),100)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map