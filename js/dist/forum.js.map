{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://lady-byron-tag-categories/webpack/bootstrap","webpack://lady-byron-tag-categories/webpack/runtime/compat get default export","webpack://lady-byron-tag-categories/webpack/runtime/define property getters","webpack://lady-byron-tag-categories/webpack/runtime/hasOwnProperty shorthand","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['forum/app']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['common/extend']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['common/components/Button']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['tags/forum/components/TagDiscussionModal']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['tags/forum/components/TagSelectionModal']\"","webpack://lady-byron-tag-categories/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['common/utils/classList']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['common/helpers/highlight']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://lady-byron-tag-categories/external root \"flarum.core.compat['tags/common/helpers/tagIcon']\"","webpack://lady-byron-tag-categories/./src/forum/components/GroupedTagDiscussionModal.tsx","webpack://lady-byron-tag-categories/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://lady-byron-tag-categories/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/forum/components/TagDiscussionModal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/forum/components/TagSelectionModal'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/highlight'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/common/helpers/tagIcon'];","import app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport classList from 'flarum/common/utils/classList';\nimport highlight from 'flarum/common/helpers/highlight';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nimport TagDiscussionModal, { type TagDiscussionModalAttrs } from 'flarum/tags/forum/components/TagDiscussionModal';\nimport tagIcon from 'flarum/tags/common/helpers/tagIcon';\nimport type Tag from 'flarum/tags/common/models/Tag';\n\ntype Vnode = Mithril.Vnode<TagDiscussionModalAttrs, GroupedTagDiscussionModal>;\n\ninterface ForumTagCategory {\n  id: number;\n  name: string;\n  slug: string | null;\n  order: number | null;\n  tagIds: number[];\n}\n\nexport default class GroupedTagDiscussionModal extends TagDiscussionModal<TagDiscussionModalAttrs> {\n  view(vnode: Vnode) {\n    return super.view(vnode);\n  }\n\n  /**\n   * 与原生 TagSelectionModal.content() 完全一致的结构，\n   * 仅把 footer 里的列表映射改成 “分组标题 + 各组标签 + 未分组”。\n   */\n  content() {\n    // —— 原生：加载态保持不变 ——\n    // @ts-ignore - inherited\n    if (this.loading || !this.tags) {\n      return <LoadingIndicator />;\n    }\n\n    // —— 原生：顶部表单区域（chips + 搜索 + 提交）保持不变 ——\n    // @ts-ignore - inherited\n    const filterStr: string = this.filter().toLowerCase();\n    // @ts-ignore - inherited\n    const primaryCount = this.primaryCount();\n    // @ts-ignore - inherited\n    const secondaryCount = this.secondaryCount();\n    // @ts-ignore - inherited\n    const tags: Tag[] = this.getFilteredTags();\n\n    // @ts-ignore - inherited\n    const inputWidth = Math.max(this.lengthWithCJK(extractTextLike(this.getInstruction(primaryCount, secondaryCount))), this.lengthWithCJK(this.filter()));\n\n    // ===== 仅从这里开始“改造列表” =====\n    const categories: ForumTagCategory[] = (app.forum.attribute('tagCategories') as ForumTagCategory[]) || [];\n    const id2tag = new Map<number, Tag>(tags.map((t) => [Number(t.id()), t]));\n\n    // 组装每个分组下的标签（已按原生 sort + 过滤后的集合）\n    const groupedEntries = categories\n      .map((g) => {\n        const list = (g.tagIds || [])\n          .map((id) => id2tag.get(Number(id)))\n          .filter(Boolean) as Tag[];\n        return { group: g, tags: list };\n      })\n      .filter((e) => e.tags.length > 0);\n\n    // 统计已分组的 id，用于计算“未分组”\n    const groupedIdSet = new Set<number>();\n    groupedEntries.forEach((e) => e.tags.forEach((t) => groupedIdSet.add(Number(t.id()))));\n    const ungrouped = tags.filter((t) => !groupedIdSet.has(Number(t.id())));\n\n    // 组装最终要渲染到 <ul> 里的子节点数组\n    let listItems: Mithril.Children[] = [];\n\n    // 如果没有任何有效分组，就回退到原生列表（外观完全一致）\n    if (!groupedEntries.length) {\n      listItems = tags.map((tag) => this.renderTagLi(tag, filterStr));\n    } else {\n      // 分组标题行：使用一个极轻量的类名，保持原生 ul/li 结构\n      for (const { group, tags: list } of groupedEntries) {\n        listItems.push(\n          <li className=\"TagSelectionModal-groupHeader\">{group.name}</li>,\n          ...list.map((tag) => this.renderTagLi(tag, filterStr))\n        );\n      }\n\n      if (ungrouped.length) {\n        listItems.push(\n          <li className=\"TagSelectionModal-groupHeader\">\n            {app.translator.trans('lady-byron-tag-categories.forum.tag_selection.ungrouped')}\n          </li>,\n          ...ungrouped.map((tag) => this.renderTagLi(tag, filterStr))\n        );\n      }\n    }\n\n    // —— 原生整体结构（body + footer）保持不变，仅替换 footer 列表内容 ——\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"TagSelectionModal-form\">\n          <div className=\"TagSelectionModal-form-input\">\n            {/* 原生 chips + 输入框 */}\n            <div\n              className={'TagsInput FormControl ' + (/* @ts-ignore */ this.focused ? 'focus' : '')}\n              onclick={() => this.$('.TagsInput input').focus()}\n            >\n              <span className=\"TagsInput-selected\">\n                {\n                  // @ts-ignore\n                  this.selected.map((tag: Tag) => (\n                    <span\n                      className=\"TagsInput-tag\"\n                      onclick={() => {\n                        // @ts-ignore\n                        this.removeTag(tag);\n                        // @ts-ignore\n                        this.onready();\n                      }}\n                    >\n                      {tagLabelLike(tag)}\n                    </span>\n                  ))\n                }\n              </span>\n              <input\n                className=\"FormControl\"\n                // @ts-ignore\n                placeholder={extractTextLike(this.getInstruction(primaryCount, secondaryCount))}\n                // @ts-ignore\n                bidi={this.filter}\n                style={{ width: inputWidth + 'ch' }}\n                // @ts-ignore\n                onkeydown={this.navigator.navigate.bind(this.navigator)}\n                // @ts-ignore\n                onfocus={() => (this.focused = true)}\n                // @ts-ignore\n                onblur={() => (this.focused = false)}\n              />\n            </div>\n          </div>\n          <div className=\"TagSelectionModal-form-submit App-primaryControl\">\n            <Button\n              type=\"submit\"\n              className=\"Button Button--primary\"\n              // @ts-ignore\n              disabled={!this.meetsRequirements(primaryCount, secondaryCount)}\n              icon=\"fas fa-check\"\n            >\n              {app.translator.trans('flarum-tags.lib.tag_selection_modal.submit_button')}\n            </Button>\n          </div>\n        </div>\n      </div>,\n\n      <div className=\"Modal-footer\">\n        <ul className=\"TagSelectionModal-list SelectTagList\">{listItems}</ul>\n        {\n          // 保留原生的 “忽略标签选择（bypass）” 开关\n          // @ts-ignore\n          this.attrs.limits?.allowBypassing && (\n            <div className=\"TagSelectionModal-controls\">\n              {/* 这里沿用原生 ToggleButton 的 DOM 结构/类名由原生组件负责；父类里会导入并渲染 */}\n              <button className={classList('Button', { 'Button--toggled': /* @ts-ignore */ this.bypassReqs })} onclick={() => (/* @ts-ignore */ this.bypassReqs = !this.bypassReqs)}>\n                {app.translator.trans('flarum-tags.lib.tag_selection_modal.bypass_requirements')}\n              </button>\n            </div>\n          )\n        }\n      </div>,\n    ];\n  }\n\n  /** 渲染单个标签项：DOM 与类名完全照搬原生，实现原生外观与交互 */\n  private renderTagLi(tag: Tag, filterStr: string) {\n    // @ts-ignore - inherited\n    const selected = this.selected.includes(tag);\n    // @ts-ignore - inherited\n    const active = this.indexTag === tag;\n\n    return (\n      <li\n        data-index={tag.id()}\n        className={classList('SelectTagListItem', {\n          pinned: tag.position() !== null,\n          child: !!tag.parent(),\n          colored: !!tag.color(),\n          selected,\n          active,\n        })}\n        style={{ color: tag.color() || undefined }}\n        // @ts-ignore\n        onmouseover={() => (this.indexTag = tag)}\n        // @ts-ignore\n        onclick={this.toggleTag.bind(this, tag)}\n      >\n        <i className=\"SelectTagListItem-icon\">\n          {tagIcon(tag, { className: 'SelectTagListItem-tagIcon' })}\n          <i className=\"icon TagIcon fas fa-check SelectTagListItem-checkIcon\"></i>\n        </i>\n        <span className=\"SelectTagListItem-name\">{highlight(tag.name(), filterStr)}</span>\n        {tag.description() ? <span className=\"SelectTagListItem-description\">{tag.description()}</span> : ''}\n      </li>\n    );\n  }\n}\n\n/** 下面两个小 helper 只是把原生文件里用到的 extractText、tagLabel 的效果“就地复刻”以避免额外导入 */\nfunction extractTextLike(v: any): string {\n  if (typeof v === 'string') return v;\n  // flarum 原生 extractText 会从 VDOM 里抽文本，这里保守返回空字符串以保持结构，\n  // 真正的占位文本已经由 flarum/tags 的翻译提供\n  return '';\n}\nfunction tagLabelLike(tag: Tag) {\n  // 仅用于 chips 内的只读展示，原生 tagLabel 会渲染图标+名称。\n  // 这里直接复用名称即可；若你希望100%一致，可改为从 flarum/tags 导入 tagLabel。\n  return tag.name();\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport Button from 'flarum/common/components/Button';\n\n// 原生弹窗\nimport TagDiscussionModal from 'flarum/tags/forum/components/TagDiscussionModal';\nimport TagSelectionModal from 'flarum/tags/forum/components/TagSelectionModal';\n\n// 我们的分组版弹窗（同时兼容“编辑已有讨论”和“新建时选择”两种场景）\nimport GroupedTagDiscussionModal from './components/GroupedTagDiscussionModal';\n\nconst EXT_ID = 'lady-byron/tag-categories';\n\napp.initializers.add(EXT_ID, () => {\n  const originalShow = app.modal.show.bind(app.modal);\n\n  // ✅ 统一在 show 入口替换，不在 oninit 里做切换，避免 Nested m.redraw.sync\n  (app.modal as any).show = function (component: any, attrs: any) {\n    const groups = app.forum.attribute('tagCategories') || [];\n\n    // 仅当站点存在分类组时才替换，保持无分组时沿用原生体验\n    if (groups.length && (component === TagDiscussionModal || component === TagSelectionModal)) {\n      component = GroupedTagDiscussionModal;\n    }\n\n    return originalShow(component, attrs);\n  };\n\n  // 兜底：讨论页“编辑标签”按钮也强制打开分组版\n  extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n    if (discussion.canTag && discussion.canTag()) {\n      items.add(\n        'tags',\n        <Button icon=\"fas fa-tag\" onclick={() => app.modal.show(GroupedTagDiscussionModal, { discussion })}>\n          {app.translator.trans('flarum-tags.forum.discussion_controls.edit_tags_button')}\n        </Button>,\n        100\n      );\n    }\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","GroupedTagDiscussionModal","_TagDiscussionModal","apply","arguments","create","constructor","_proto","view","vnode","content","_this$attrs$limits","_this","this","loading","tags","m","LoadingIndicator","filterStr","filter","toLowerCase","primaryCount","secondaryCount","getFilteredTags","inputWidth","Math","max","lengthWithCJK","extractTextLike","getInstruction","categories","app","attribute","id2tag","Map","map","Number","id","groupedEntries","g","group","tagIds","Boolean","length","groupedIdSet","Set","forEach","add","ungrouped","has","listItems","_step","_iterator","_createForOfIteratorHelperLoose","done","_listItems2","_step$value","value","list","push","className","name","concat","tag","renderTagLi","_listItems","trans","focused","onclick","$","focus","selected","removeTag","onready","tagLabelLike","placeholder","bidi","style","width","onkeydown","navigator","navigate","onfocus","onblur","Button","type","disabled","meetsRequirements","icon","attrs","limits","allowBypassing","classList","bypassReqs","_this2","includes","active","indexTag","pinned","position","child","parent","colored","color","undefined","onmouseover","toggleTag","tagIcon","highlight","description","TagDiscussionModal","v","originalShow","show","component","TagSelectionModal","extend","DiscussionControls","items","discussion","canTag"],"sourceRoot":""}